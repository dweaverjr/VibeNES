{
    "version": "2.0.0",
    "options": {
        "shell": {
            "executable": "cmd.exe",
            "args": [
                "/d",
                "/c"
            ]
        },
        "env": {
            "VCVARS": "\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2022\\BuildTools\\VC\\Auxiliary\\Build\\vcvarsall.bat\" amd64",
            "CMAKE": "\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2022\\BuildTools\\Common7\\IDE\\CommonExtensions\\Microsoft\\CMake\\CMake\\bin\\cmake.exe\""
        }
    },
    "tasks": [
        {
            "label": "Build Debug",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset debug && %CMAKE% --build --preset debug",
            "group": "build",
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Configure + build debug (MSVC + Ninja)"
        },
        {
            "label": "Build Release",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset release && %CMAKE% --build --preset release",
            "group": "build",
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Configure + build release (MSVC + Ninja)"
        },
        {
            "label": "Run Tests",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset debug && %CMAKE% --build --preset debug && %CMAKE% -E chdir build/debug ctest --output-on-failure",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Build + run all CTest suites (debug)"
        },
        {
            "label": "Run Tests: CPU",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset debug && %CMAKE% --build --preset debug && %CMAKE% -E chdir build/debug ctest -R CPU --output-on-failure",
            "group": "test",
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Build + run CPU tests only"
        },
        {
            "label": "Run Tests: PPU",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset debug && %CMAKE% --build --preset debug && %CMAKE% -E chdir build/debug ctest -R PPU --output-on-failure",
            "group": "test",
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Build + run PPU tests only"
        },
        {
            "label": "Run Tests: by name...",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --preset debug && %CMAKE% --build --preset debug && .\\build\\debug\\VibeNES_Tests.exe \"${input:testFilter}\" --order rand",
            "group": "test",
            "problemMatcher": [
                "$msCompile"
            ],
            "presentation": {
                "reveal": "always",
                "clear": true
            },
            "detail": "Build + run tests matching a Catch2 name/tag filter"
        },
        {
            "label": "Run VibeNES (Debug)",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --build --preset debug && .\\build\\debug\\VibeNES_GUI.exe",
            "group": "build",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always"
            },
            "detail": "Build + run debug executable"
        },
        {
            "label": "Run VibeNES (Release)",
            "type": "shell",
            "command": "%VCVARS% && %CMAKE% --build --preset release && .\\build\\release\\VibeNES_GUI.exe",
            "group": "build",
            "problemMatcher": [],
            "presentation": {
                "reveal": "always"
            },
            "detail": "Build + run release executable"
        },
        {
            "label": "Clean",
            "type": "shell",
            "command": "if exist build\\debug rmdir /s /q build\\debug && if exist build\\release rmdir /s /q build\\release",
            "presentation": {
                "reveal": "always"
            },
            "detail": "Remove all build directories"
        }
    ],
    "inputs": [
        {
            "id": "testFilter",
            "description": "Catch2 test name or tag filter (e.g. [ppu], [palette], \"Sprite 0*\")",
            "type": "promptString",
            "default": "[ppu]"
        }
    ]
}
